{% extends "master.html" %}

{% block title %}
    <title>Links</title>
{% endblock %}
{% block submenu %}
<div>
  <nav class="navbar navbar-expand-lg bg-light" id="network_nav">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Links</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">

          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="/add-link/">Add link</a>
            <!-- <a class="nav-link" aria-current="page" data-bs-toggle="offcanvas" href="#linkSidebar" role="button" aria-controls="offcanvasExample">Add link</a> -->
          </li>      
          
        </ul>
      </div>
    </div>
  </nav>
  </div>

{% endblock %}



{% block content %}
<div class="container">   

<table class="table table-borderless align-middle w-auto mt-3">

  <th scope="col" colspan=2 style="width: 400px">From node</th>

  <th scope="col" colspan=2 style="width: 400px">To node</th>
  <th scope="col">Enabled</th>
  <th scope="col"></th>
  <th scope="col"></th>


<form action="/links/" method="post" id="category_selection">
  {%csrf_token%}
</form>
  <tr>

<td colspan=2>
  <select class="form-select" aria-label="From category filter" name="from_category" id="from_category" form="category_selection" onchange="this.form.submit()" >

      <option value="All">All categories</option>
      {% for x in categories %}
      {% if x.from_category %}
      <option value="{{ x.id }}" selected>{{ x.category_code }}: {{ x.category_text }}</option>
      {% else %}
      <option value="{{ x.id }}">{{ x.category_code }}: {{ x.category_text }}</option>
      {% endif %}
      {% endfor %}
    </select>
    
</td>

<td colspan=2>
  <select class="form-select" aria-label="To category filter" name="to_category" id="to_category"  form="category_selection" onchange="this.form.submit()" >

    <option value="All">All categories</option>
    {% for x in categories %}
    {% if x.to_category %}
    <option value="{{ x.id }}" selected>{{ x.category_code }}: {{ x.category_text }}</option>
    {% else %}
    <option value="{{ x.id }}">{{ x.category_code }}: {{ x.category_text }}</option>
    {% endif %}
    {% endfor %}
  </select>

</td>
<td></td>
<td></td>
<td></td>
<td></td>

</tr>

{% for x in links %}
<tr id="row{{x.id}}">
<td style="width: 50px">
  <a>{{x.from_node.category.category_code}}:{{x.from_node.node_code}}</a>
</td>  
<td>
<a>{{x.from_node.node_text}}</a>
</td>
<td style="width: 50px">
  <a>{{x.to_node.category.category_code}}:{{x.to_node.node_code}}</a>
</td>
<td>
  <a style="text-align: left;">{{x.to_node.node_text}}</a>
</td>

<td>
  <div class="container" style="align-items: center;">
  <!-- <form action="/switch/link/{{x.id}}"> -->
  <form method="post" id="switch"> 
    {% csrf_token %} 
  <div class="form-check form-switch">
    {% if x.enabled %}
    <!-- <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault" onchange=this.form.submit() checked> -->
    <!-- <input class="form-check-input" id="flexSwitchCheckDefault" type="checkbox" value="{{x.id}}" onchange=this.form.requestSubmit() checked > -->
    <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault" value='{"id": {{x.id}}, "ob_type": "link"}' onchange="saveSwitch(this.value)" checked>
    {% else %}
    <!-- <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault" onchange=this.form.submit()> -->
    <!-- <input class="form-check-input" id="flexSwitchCheckDefault" type="checkbox" value="{{x.id}}" onchange=this.form.requestSubmit()> -->
    <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault" value='{"id": {{x.id}}, "ob_type": "link"}' onchange="saveSwitch(this.value)">
    {% endif %}
  </div>
</div>
</form>

</td>


<td><form action="/edit-link/{{x.id}}" onsubmit="showPleaseWait()">
  <!-- {% csrf_token %} -->
  <!-- <input type="hidden" id="node_id" type="text" name="node_id" value={{x.id}}> -->
  <!-- <button type="submit" class="btn btn-secondary btn-sm">Edit</button> -->
  <input type="image" name="submit" src="/static/icons/pencil.svg" alt="Submit" style="width:20px;height:auto;"/>
</form></td>

<td>
<form id="del{{x.id}}" onsubmit="return false;">
  <!-- {% csrf_token %} -->
  <!-- <input type="hidden" id="del_node" type="text" name="del_node" value={{x.id}}> -->
  <!-- <button type="submit" class="btn btn-secondary btn-sm">Delete</button> -->
  <input type="image" src="/static/icons/trash3.svg" value='{"id": {{x.id}}, "ob_type": "link", "backup": true}' onclick="delAJAX(this.value)" style="width:20px;height:auto;"/>
</form>
</td>

</tr>
{% endfor %}
</table>


<p></p>
</div> 
{% endblock %}
